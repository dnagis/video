#### RPi element perso basé sur template videofilter pour dropper des frames


## Génerer un fichier de départ videotestsrc 

# Caractéristiques par défaut
gst-launch-1.0 videotestsrc num-buffers=100 ! v4l2h264enc ! 'video/x-h264,level=(string)3' ! h264parse ! mp4mux ! filesink location=in.mp4

# 640x480 (attention a déjà planté une fois, je suppose que l'encodeur a du mal à suivre, si se renouvelle tenter is-live
gst-launch-1.0 videotestsrc num-buffers=100 ! video/x-raw,width=640,height=480 ! v4l2h264enc ! 'video/x-h264,level=(string)3' ! h264parse ! mp4mux ! filesink location=in.mp4

#Decode + réencode
gst-launch-1.0 filesrc location=in.mp4 ! qtdemux ! h264parse ! v4l2h264dec ! v4l2h264enc ! 'video/x-h264,level=(string)3' ! h264parse ! mp4mux ! filesink location=out.mp4




## Recette génération du .so initial
cd /initrd/mnt/dev_save/packages/gst-plugins-bad-1.18.1/tools/
./gst-element-maker my_drop_frames videofilter

--> gstmydropframes.[c,h] symlinks depuis github video/gst/element_perso/




## X compil (peut se faire dans n'importe quel dir)
export PATH=$PATH:/initrd/mnt/dev_save/rpi/cross/bin/
export PKG_CONFIG_LIBDIR=/initrd/mnt/dev_save/rpi/cross/aarch64-linux-gnu/lib/pkgconfig
export PKG_CONFIG_SYSROOT_DIR=/initrd/mnt/dev_save/rpi/cross/aarch64-linux-gnu

aarch64-linux-gnu-gcc -Wall -Werror -fPIC $(pkg-config --cflags gstreamer-1.0 gstreamer-video-1.0) -c -o gstmydropframes.o gstmydropframes.c
aarch64-linux-gnu-gcc -shared -o gstmydropframes.so gstmydropframes.o $(pkg-config --libs gstreamer-1.0 gstreamer-video-1.0)

#push vers le RPi
scp gstmydropframes.so p:/lib/gstreamer-1.0/



#Je place mon element entre le decodeur et l'encodeur
GST_DEBUG=mydropframes:7 gst-launch-1.0 filesrc location=in.mp4 ! qtdemux ! h264parse ! v4l2h264dec ! mydropframes ! v4l2h264enc ! 'video/x-h264,level=(string)3' ! h264parse ! mp4mux ! filesink location=out.mp4

Génère un fichier out.mp4, de la bonne taille, vert (vide) quand je ne copy pas les frames. 


## Element qui prend les properties start-frame et end-frame

#La pipeline pour l'élément avec les properties start-frame et end-frame set
GST_DEBUG=mydropframes:7 gst-launch-1.0 filesrc location=in.mp4 ! qtdemux ! h264parse ! v4l2h264dec ! mydropframes start-frame=30 end-frame=70 \
! v4l2h264enc ! 'video/x-h264,level=(string)3' ! h264parse ! mp4mux ! filesink location=out.mp4
